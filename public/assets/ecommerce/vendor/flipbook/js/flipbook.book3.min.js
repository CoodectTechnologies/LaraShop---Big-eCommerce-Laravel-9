/*
Real3D FlipBook
version 3.35
author http://codecanyon.net/user/creativeinteractivemedia/portfolio?ref=creativeinteractivemedia
*/
var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.Book3=function(t,i,e){this.options=e,this.main=i,this.singlePage=e.singlePageMode,this.pageWidth=this.options.pageWidth,this.pageHeight=this.options.pageHeight,this.wrapper=t,this.$wrapper=jQuery(this.wrapper).addClass("flipbook-book3"),this.$bookLayer=this.$wrapper.parent(),this.bookLayer=this.$bookLayer[0],this.flipEasing="easeInOutCubic",this.flipEasing="easeOutSine",this.flipEasing="easeOutQuad",this.scroll=new FLIPBOOK.IScroll(this.bookLayer,{zoom:!0,scrollX:!0,scrollY:!0,scrollbars:!0,keepInCenterV:!0,keepInCenterH:!0,freeScroll:!0,preventDefault:!1});var o=this;i.on("toolMove",function(){o.updateTool()}),i.on("toolSelect",function(){o.updateTool()}),i.on("updateTool",function(){o.updateTool()}),this.scroll.on("zoomEnd",function(){if(isNaN(o.scroll.scale))o.zoomTo(e.zoomMin);else{e.main.onZoom(o.scroll.scale/o.ratio);var t=e.main.zoom;o.scroll.options.eventPassthrough=t>1?"":"vertical",o.scroll.options.freeScroll=t>1,o.scroll.refresh()}}),this.scroll.on("zoomStart",function(){});var s=this.wrapper.style;s.width=String(2*this.pageWidth)+"px",s.height=String(this.pageHeight)+"px";var n,a=3*this.pageHeight+"px";this.$centerContainer=jQuery("<div>").appendTo(this.$wrapper).addClass("flipbook-center-container3"),this.$centerContainer.css({"-webkit-perspective":a,perspective:a}),this.centerContainerStyle=this.$centerContainer[0].style,this.centerContainerStyle.width=2*this.pageWidth+"px",this.centerContainerStyle.height=this.pageHeight+"px",this.pagesArr=[],this.animating=!1,this.setRightIndex(e.rightToLeft?e.pages.length:0),o.updateFlipped(),this.numPages=e.pages.length;for(var h=0;h<e.numPages;h++)(n=new FLIPBOOK.Page3(this,h,e.pages[h].src,e.pages[h].htmlContent)).hideHtml(),this.pagesArr.push(n),this.$centerContainer.append(n.$wrapper),this.flippedright++;this.pagesArr[0].show(),this.options.cover||((n=new FLIPBOOK.Page3(this,e.numPages,"","")).hideHtml(),this.pagesArr.push(n),this.$centerContainer.append(n.$wrapper),this.flippedright++),this.nextEnabled=!0,this.prevEnabled=!0},FLIPBOOK.Book3.prototype=Object.create(FLIPBOOK.Book.prototype),FLIPBOOK.Book3.prototype.constructor=FLIPBOOK.Book3,FLIPBOOK.Book3.prototype.enableMouseWheelZoom=function(){this.scroll.options.eventPassthrough="vertical",this.scroll.refresh()},FLIPBOOK.Book3.prototype.disableMouseWheelZoom=function(){this.scroll.options.eventPassthrough="",this.scroll.refresh()},FLIPBOOK.Book3.prototype.enablePrev=function(t){this.prevEnabled=t},FLIPBOOK.Book3.prototype.enablePan=function(){this.scroll.enable()},FLIPBOOK.Book3.prototype.disablePan=function(){this.scroll.disable()},FLIPBOOK.Book3.prototype.setRightIndex=function(t){this.rightIndex=t},FLIPBOOK.Book3.prototype.updateTool=function(){switch(this.options.main.tool){case"toolSelect":this.disablePan(),jQuery(".flipbook-textLayer").css("pointer-events","auto").removeClass(".flipbook-noselect");break;case"toolMove":this.enablePan(),jQuery(".flipbook-textLayer").css("pointer-events","none").addClass(".flipbook-noselect")}},FLIPBOOK.Book3.prototype.enableNext=function(t){this.nextEnabled=t},FLIPBOOK.Book3.prototype.isZoomed=function(){return this.options.main.zoom>this.options.zoomMin&&this.options.main.zoom>1},FLIPBOOK.Book3.prototype.onZoom=function(){},FLIPBOOK.Book3.prototype.getNumPages=function(){},FLIPBOOK.Book3.prototype.move=function(t){if(!(this.zoom<=1)){var i=this.scroll;if(i){var e=i.x,o=i.y,s=20*this.zoom;switch(t){case"left":e+=s;break;case"right":e-=s;break;case"up":o+=s;break;case"down":o-=s}e>0&&(e=0),e<i.maxScrollX&&(e=i.maxScrollX-0),o>0&&(o=0),o<i.maxScrollY&&(o=i.maxScrollY-0),i.scrollTo(e,o,0)}}},FLIPBOOK.Book3.prototype.zoomTo=function(t,i,e,o){if(this.enabled){e=e||0,o=o||0,i=i||0;this.zoom=t,i=0;var s=this.scroll;s&&s.zoom(t*this.ratio,e,o,i)}},FLIPBOOK.Book3.prototype.setWrapperW=function(t){this.$wrapperW!=t&&(this.$wrapper.width(t),this.$wrapperW=t)},FLIPBOOK.Book3.prototype.updateBookPosition=function(){if(this.options.singlePageMode)return this.setWrapperW(this.pageWidth),this.$wrapper.width(this.pageWidth),this.scroll&&this.scroll.refresh(),this.view=1,void this.focusRight();1==this.view?this.setWrapperW(this.pageWidth):this.setWrapperW(2*this.pageWidth),this.scroll&&this.scroll.refresh(),2==this.view?this.isCover()?this.focusRight():this.isBackCover()&&this.options.cover?this.focusLeft():this.focusBoth():1==this.view&&(this.isCover()?this.focusRight():this.isBackCover()&&this.focusLeft())},FLIPBOOK.Book3.prototype.focusLeft=function(t,i){var e=1==this.view||this.options.singlePageMode?0:this.pageWidth/2;this.setBookPosition(e,t,i)},FLIPBOOK.Book3.prototype.focusRight=function(t,i){var e=1==this.view||this.options.singlePageMode?-this.pageWidth:-this.pageWidth/2;this.setBookPosition(e,t,i)},FLIPBOOK.Book3.prototype.focusBoth=function(t,i){var e=1==this.view?-this.pageWidth/2:0;this.setBookPosition(e,t,i)},FLIPBOOK.Book3.prototype.setBookPosition=function(t,i,e){if(this.centerContainerPosition!=t){var o=this.centerContainerPosition;if(i){var s=this;e=e||0,jQuery({someValue:o}).delay(e).animate({someValue:t},{duration:i,easing:this.flipEasing,step:function(t){s._setStyle(s.centerContainerStyle,FLIPBOOK.IScroll.utils.style.transform,"translateX("+t+"px) translateZ(0)")},complete:function(){s.centerContainerPosition=t,s.updateFlipped(),s.options.main.turnPageComplete()}})}else{var n="translateX("+t+"px)";this.centerContainerPosition=t,this._setStyle(this.centerContainerStyle,FLIPBOOK.IScroll.utils.style.transform,n),this.updateFlipped(),this.options.main.turnPageComplete()}}},FLIPBOOK.Book3.prototype.updateVisiblePages=function(t){void 0===t&&(t=!0);var i=this,e=FLIPBOOK.IScroll.utils.style.transform,o=this.rightIndex;!this.options.backCover&&this.options.rightToLeft&&o--;for(var s=0;s<this.pagesArr.length;s++)s==o||s==o-1&&!this.options.singlePageMode?this.pagesArr[s].show():this.pagesArr[s].hide(),this.pagesArr[s]._setZIndex(0),this.pagesArr[s]._setStyle(this.pagesArr[s].wrapper.style,e,"");this.updateBookPosition();var n=this.pagesArr[o],a=this.pagesArr[o-1],h=this.pagesArr[o+1],r=this.pagesArr[o+2],p=this.pagesArr[o-2],l=this.pagesArr[o-3];a?(i.options.main.setLoadingProgress(.1),a.load(function(){i.options.main.setLoadingProgress(1),a.startHTML(),n?n.load(function(){i.options.main.setLoadingProgress(1),p&&p.load(null,!0),l&&l.load(null,!0),h&&h.load(null,!0),r&&r.load(null,!0),i.options.doublePage&&2==i.view||n.startHTML()}):(p&&p.load(null,!0),l&&l.load(null,!0))})):(i.options.main.setLoadingProgress(.1),n.load(function(){i.options.main.setLoadingProgress(1),h&&h.load(null,!0),r&&r.load(null,!0),n.startHTML()}));var g=this.options.rightToLeft?-this.main.bookW:0;this.scroll.scrollTo(g,0,300)},FLIPBOOK.Book3.prototype.enable=function(){this.onResize(),this.enabled=!0},FLIPBOOK.Book3.prototype.disable=function(){this.onResize(),this.enabled=!1},FLIPBOOK.Book3.prototype.getLeftPage=function(){return this.pagesArr[this.flippedleft-1]},FLIPBOOK.Book3.prototype.getRightPage=function(){return this.pagesArr[this.flippedleft]},FLIPBOOK.Book3.prototype.getLeftBackPage=function(){return this.pagesArr[this.flippedleft-2]},FLIPBOOK.Book3.prototype.getRightBackPage=function(){return this.pagesArr[this.flippedleft+1]},FLIPBOOK.Book3.prototype.getNextPage=function(){return this.pagesArr[this.flippedleft+2]},FLIPBOOK.Book3.prototype.getPrevPage=function(){return this.pagesArr[this.flippedleft-3]},FLIPBOOK.Book3.prototype.nextPage=function(){if(this.nextEnabled)if(1!=this.view||!this.isFocusedLeft()||this.options.singlePageMode)this.goToPage(this.rightIndex+2);else{var t=700*this.options.pageFlipDuration/2;this.focusRight(t)}},FLIPBOOK.Book3.prototype.prevPage=function(){if(this.prevEnabled)if(1!=this.view||!this.isFocusedRight()||this.options.singlePageMode){var t=this.options.singlePageMode?this.rightIndex:this.rightIndex-2;this.goToPage(t)}else{var i=700*this.options.pageFlipDuration/2;this.focusLeft(i)}},FLIPBOOK.Book3.prototype.goToPage=function(t,i){if(this.enabled&&!this.flipping&&((this.options.singlePageMode||t%2!=0)&&t--,t<0&&(t=0),t>this.options.pages.length&&(t=this.options.pages.length),t!=this.rightIndex)){if(i||this.options.instantFlip)return this.setRightIndex(t),this.updateFlipped(),this.updateVisiblePages(),void this.options.main.turnPageComplete();this.flipping=!0;var e=this.flipEasing;void 0===jQuery.easing[e]&&this.options.main.initEasing();var o=700*this.options.pageFlipDuration;this.options.singlePageMode||(1==this.view?t<this.rightIndex?this.focusRight(o):this.focusLeft(o):0==t?this.focusRight(o):t==this.pagesArr.length?this.focusLeft(o):this.focusBoth(o));var s=this;this.goingToPage=t,t>this.rightIndex?(end=180,(s.angle<=0||s.angle>=180||!s.angle)&&(s.angle=1)):t<this.rightIndex&&(end=-180,(s.angle>=0||s.angle<=-180||!s.angle)&&(s.angle=-1)),this.options.singlePageMode&&(o/=2),jQuery({someValue:s.angle}).animate({someValue:end},{duration:o,easing:e,step:function(t){s._setPageAngle(t)},complete:function(){s.setRightIndex(s.goingToPage),s.angle=0,s.flipping=!1,s.updateFlipped(),s.updateVisiblePages(),s.options.main.turnPageComplete()}}),s.options.main.playFlipSound()}},FLIPBOOK.Book3.prototype.updateFlipped=function(){this.flippedleft=(this.rightIndex+this.rightIndex%2)/2,this.flippedright=this.options.pages.length/2-this.flippedleft},FLIPBOOK.Book3.prototype.onSwipe=function(t,i,e,o,s,n,a){if(!this.isZoomed()&&"flipbook-page-link"!=t.target.className&&"start"!=i&&"up"!=e&&"down"!=e&&!this.flipping){"right"==e&&(o*=-1);var h=180*o/this.main.wrapperW;if("cancel"==i&&n<=1&&(h>0?this.nextPage():h<0&&this.prevPage()),"end"==i&&n<=1&&(h>0?this.nextPage():h<0&&this.prevPage()),"move"==i&&n<=1){if(h>0){if(!this.nextEnabled)return;if(this.options.singlePageMode&&this.rightIndex==this.pagesArr.length-1)return;this.goingToPage=this.options.singlePageMode?this.rightIndex+1:this.rightIndex+2}else if(h<0){if(!this.prevEnabled)return;this.goingToPage=this.options.singlePageMode?this.rightIndex-1:this.rightIndex-2}this.goingToPage!=this.rightIndex&&this.goingToPage>=0&&this.goingToPage<=this.pagesArr.length&&(this.options.instantFlip||this._setPageAngle(h))}}},FLIPBOOK.Book3.prototype.hideHtml=function(t,i,e){for(var o=0;o<this.pagesArr.length;o++)this.pagesArr[o].hideHtml()},FLIPBOOK.Book3.prototype._setStyle=function(t,i,e){t&&(t[i]=e)},FLIPBOOK.Book3.prototype._setPageAngle=function(t){var i,e,o,s;if(this.angle=t,this.hideHtml(),this.options.singlePageMode)t>0?((o=this.pagesArr[this.rightIndex])._setAngle(t/2),(e=this.pagesArr[this.goingToPage])&&(e.show(),e.load())):((s=this.pagesArr[this.goingToPage]).show(),s.load(),s._setAngle(t/2+90),o=this.pagesArr[this.rightIndex]);else{var n=this.rightIndex,a=this.goingToPage;if(this.options.rightToLeft&&!this.options.backCover&&(n--,a--),t>0){if(1==this.view&&this.isFocusedLeft())return;o=this.pagesArr[n],s=this.pagesArr[a-1],this.applyAngles(o,s,t,90,0),e=this.pagesArr[a],o.setShadowOpacity((t-10)/600),s.setShadowOpacity((180-t-10)/600),s.load(),e&&(e.show(),e.load())}else{if(1==this.view&&this.isFocusedRight())return;s=this.pagesArr[n-1],(o=this.pagesArr[a]).load(),this.applyAngles(o,s,t,-90,180),o.setShadowOpacity((180+t-10)/600),s.setShadowOpacity((-t-10)/600),(i=this.pagesArr[a-1])&&(i.show(),i.load())}}},FLIPBOOK.Book3.prototype.isCover=function(){return 0==this.rightIndex},FLIPBOOK.Book3.prototype.isBackCover=function(){return this.rightIndex==this.options.pages.length},FLIPBOOK.Book3.prototype.applyAngles=function(t,i,e,o,s){e<o?(t&&(t.show(),t._setAngle(e+s)),i&&(i.hide(),i._setAngle(45))):(i&&(i.show(),i._setAngle(e+s)),t&&(t.hide(),t._setAngle(45)))},FLIPBOOK.Book3.prototype.onPageUnloaded=function(t,i){var e=t;this.options.rightToLeft&&(e=this.options.pages.length-t-1),this.pagesArr[e]&&this.pagesArr[e].unload()},FLIPBOOK.Book3.prototype.onResize=function(){var t=(r=this.main).wrapperW,i=r.wrapperH,e=r.bookW,o=r.bookH,s=r.pageW,n=r.pageH,a=t/i,h=s/n,r=this.options.main,p=this.options,l=this;function g(){l.ratio=i/o,c()}function d(){l.ratio=1==l.view?t/s:t/e,c()}function c(){l.scroll&&(l.scroll.options.zoomMin=l.ratio*p.zoomMin),l.scroll&&(l.scroll.options.zoomMax=l.ratio*p.zoomMax),l.updateBookPosition(),l.scroll&&l.scroll.zoom(l.ratio*p.main.zoom,t/2,i/2,0)}Math.min(this.zoom,1),Number(this.options.zoomMin);!this.options.singlePageMode&&this.options.responsiveView&&t<=this.options.responsiveViewTreshold&&a<2*h&&a<this.options.responsiveViewRatio?(this.view=1,t/i>s/n?g():d()):(this.view=2,t/i>=e/o?g():d()),this.updateBookPosition(),this.updateFlipped(),this.options.main.turnPageComplete()},FLIPBOOK.Book3.prototype.isFocusedRight=function(){var t=1==this.view?-this.pageWidth/2:0;return this.options.singlePageMode?this.rightIndex%2==0:this.centerContainerPosition<t},FLIPBOOK.Book3.prototype.isFocusedLeft=function(){var t=1==this.view?-this.pageWidth/2:0;return this.options.singlePageMode?this.rightIndex%2==1:this.centerContainerPosition>t},FLIPBOOK.Page3=function(t,i,e,o){this.book=t,this.main=t.main,this.options=t.options,this.texture=e,this.html=o,this.index=i,this.$wrapper=jQuery("<div>").addClass("flipbook-page3").width(t.options.pageWidth).height(t.options.pageHeight),this.wrapper=this.$wrapper[0];var s=t.options;this.$inner=jQuery("<div>").appendTo(this.$wrapper).addClass("flipbook-page3-inner"),this.$bg=jQuery("<div>").appendTo(this.$inner).addClass("flipbook-page3-bg"),this.$html=jQuery("<div>").appendTo(this.$inner).addClass("flipbook-page3-html").addClass("page_"+i),this.$html[0].style.width=1e3*s.pageWidth/s.pageHeight+"px",this.$html[0].style.transform="scale("+this.options.pageHeight/1e3+") translateZ(0)",this.options.doublePage&&(this.index%2==0&&this.index>0?this.$html[0].style.left="-100%":this.$html[0].style.left="0"),this.$shadow=jQuery("<div>").appendTo(this.$wrapper).addClass("flipbook-page3-shadow"),s.pagePreloader?this.$preloader=jQuery('<img src="'+s.pagePreloader+'" class="flipbook-page-preloader-image">').appendTo(this.$wrapper):this.$preloader=jQuery('<img src="'+s.assets.spinner+'" class="flipbook-page-preloader">').appendTo(this.$wrapper),this.shadow=this.$shadow[0],this.hidden=!1,this.hide(),this.zIndex=0,this.options.rightToLeft&&!this.options.backCover&&i++,this.options.singlePageMode?(this.$wrapper.css("left",String(this.book.options.pageWidth-1)+"px").addClass("flipbook-page3-front"),this.type="front"):i%2==0?(this.$wrapper.css("left",String(this.book.options.pageWidth-1)+"px").addClass("flipbook-page3-front"),this.type="front"):(this.$wrapper.addClass("flipbook-page3-back"),this.type="back")},FLIPBOOK.Page3.prototype={load:function(t,i){var e=this.options.pageTextureSize;if(this.size>=e)return i||this.loadHTML(),void(t&&t.call(this));this.size=e;var o=this,s=o.options.rightToLeft?this.book.pagesArr.length-this.index-1:this.index;this.options.main.loadPage(s,e,function(n){if(n&&n.image){var a=n.image[e]||n.image,h=(a.naturalHeight,a.naturalHeight);o.options.pageWidth,o.options.pageHeight;o.index%2!=0||"left"!=o.options.pages[s].side&&"right"!=o.options.pages[s].side||(a=a.clone,jQuery(a).css(FLIPBOOK.IScroll.utils.style.transform,"translateX(-50%) translateZ(0)")),o.$bg.empty().append(jQuery(a)),o.$preloader.hide()}i||o.loadHTML(),t&&t.call(o)})},loadHTML:function(){var t=this,i=this.options.rightToLeft?this.options.numPages-this.index-1:this.index;this.htmlContent?this.updateHtmlContent():this.options.main.loadPageHTML(i,function(i){t.htmlContent=i,t.updateHtmlContent()})},startHTML:function(){this.wrapper.querySelectorAll(".flipbook-page-item").forEach(function(t){"VIDEO"!=t.nodeName&&"AUDIO"!=t.nodeName||!t.autoplay||(t.readyState<4?t.oncanplay=function(){this.play()}:t.play())})},unload:function(){this.size=null,this.mat=!1,this.pageSize=null},setMat:function(t,i,e){},hideHtml:function(){this.htmlContentVisible&&(this.$html.empty(),this.htmlContentVisible=!1,this.main.trigger("hidepagehtml",{page:this}))},updateHtmlContent:function(){this.htmlContent&&!this.htmlContentVisible&&(this.htmlContentVisible=!0,this.$htmlContent||(this.$htmlContent=jQuery(this.htmlContent)),this.$html.empty().append(this.$htmlContent),this.main.trigger("updateTool"),this.main.trigger("showpagehtml",{page:this}))},setDataUrl:function(t,i){var e=this;this.$img.attr("src",t),this.$img[0].onload=function(){e.$wrapper.css({background:"none"})},e.html&&jQuery(e.html).appendTo(e.$inner)},show:function(){this.hidden&&(this.$wrapper[0].style.display="block",this.setShadowOpacity(0)),this.hidden=!1},setShadowOpacity:function(t){this.shadow.style.opacity=t},hide:function(){this.hidden||(this.$wrapper[0].style.display="none",this.setShadowOpacity(0)),this.hidden=!0},_setScale:function(t){if(this.scale!=t){var i=FLIPBOOK.IScroll.utils.style.transform,e="scaleX("+String(t)+") translateZ(0)";this.scale=t,this._setStyle(i,e)}},_setAngle:function(t){if(this.angle!=t){this.angle=t;var i,e,o=FLIPBOOK.IScroll.utils.style.transform,s="translateZ(0)";"3d"==this.book.options.viewMode?i="front"==this.type?"rotateY("+String(-t)+"deg) "+s:"rotateY("+String(180-t)+"deg) "+s:"2d"==this.book.options.viewMode&&("front"==this.type?(t>90&&(t=90),i="scaleX("+String((180-2*t)/180)+") "+s):(t<90&&(t=90),i="scaleX("+String(2*t/180-1)+") "+s)),this._setStyle(this.wrapper.style,o,i);var n=0;for(e=0;e<this.book.pagesArr.length;e++)e!=this.index&&this.book.pagesArr[e].zIndex>n&&(n=this.book.pagesArr[e].zIndex);this._setZIndex(n+1)}},_setZIndex:function(t){this.zIndex!=t&&(this.wrapper.style["z-index"]=t),this.zIndex=t},_setStyle:function(t,i,e){t&&(t[i]=e)}};